<h3 [class.near-limit]="columnData.hasTaskLimit() &&
                        columnData.task_limit - columnData.tasks.length === 1"
    [class.limit-reached]="columnData.hasTaskLimit() &&
                           columnData.task_limit - columnData.tasks.length < 1">
    <span class="icon icon-minus-squared-alt"
        [title]="strings['boards_collapseAllTasks']"
        *ngIf="!collapseTasks"
        (click)="toggleTaskCollapse()"></span>
    <span class="icon icon-plus-squared-alt"
        [title]="strings['boards_expandAllTasks']"
        *ngIf="collapseTasks"
        (click)="toggleTaskCollapse()"></span>

    {{ columnData.name }}

    <span class="count" *ngIf="columnData.hasTaskLimit()">
        {{ columnData.tasks.length + ' / ' + columnData.task_limit }}
    </span>

    <span class="badge" [title]="strings['boards_tasksInColumn']">
        {{ columnData.tasks && columnData.tasks.length || 0 }}
    </span>

    <span class="icon icon-angle-double-up"
        [title]="strings['boards_expandColumn']" (click)="toggleCollapsed()"></span>
    <span class="right icon icon-angle-double-down"
        [title]="strings['boards_collapseColumn']" (click)="toggleCollapsed()"></span>

    <span class="count-editor"
          *ngIf="activeUser.isAnyAdmin()">
        <i class="icon icon-hashtag"
            [title]="strings['boards_editTaskLimit']"
            (click)="beginLimitEdit()"></i>

        <div class="limit-editor" *ngIf="showLimitEditor">
            <input type="number" min="0"
                [title]="'0 = ' + strings['boards_noLimit']"
                [(ngModel)]="taskLimit">
            <i class="icon icon-cancel right"
                [title]="strings['boards_limitCancel']"
                (click)="cancelLimitChanges()"></i>
            <i class="icon icon-floppy primary right"
                [title]="strings['boards_limitSave']"
                (click)="saveLimitChanges()"></i>
        </div>
    </span>
    <span class="sort-by">
        {{ strings['sortBy'] }}:
        <select [(ngModel)]="sortOption"
            (change)="sortTasks()">
            <option value="pos">
                {{ strings['boards_sortByPosition'] }}
            </option>
            <option value="due">
                {{ strings['boards_sortByDueDate'] }}
            </option>
            <option value="pnt">
                {{ strings['boards_sortByPoints'] }}
            </option>
        </select>
    </span>
</h3>

<div class="quick-add">
    <input type="text" [placeholder]="strings['boards_quickAdd']"
        [(ngModel)]="quickAdd.title" (keyup.enter)="quickAddClicked($event)">
    <button class="flat"
        [title] = "strings['boards_addTask']"
        (click)="quickAddClicked($event)">
        <i class="icon icon-plus"></i>
    </button>
</div>

<div class="tasks">
    <tb-task class="task-container" *ngFor="let task of columnData.tasks"
        [task]="task" [boards]="boards"
        [add-task]="getShowModalFunction()"
        [edit-task]="getShowModalFunction(task.id)"
        [remove-task]="getRemoveTaskFunction(task.id)"
        (on-update-boards)="callBoardUpdate();"
        [collapse]="collapseTasks"></tb-task>
</div>

<tb-context-menu [menu-items]="contextMenuItems"></tb-context-menu>

<tb-modal modal-title="{{ strings['boards_confirmRemoveTask'] }}" blocking="true"
    modal-id="{{ MODAL_CONFIRM_ID + columnData.id }}">
    <div class="center">
        {{ strings['boards_confirmWarning'] }}<br>
        {{ strings['boards_confirmContinue'] }}
    </div>
    <div class="buttons">
        <button class="flat"
            (click)="modal.close(MODAL_CONFIRM_ID + columnData.id);removeTask()">{{ strings['yes'] }}</button>
        <button #defaultAction #focusMe
            (click)="modal.close(MODAL_CONFIRM_ID + columnData.id)">
            {{ strings['no'] }}
        </button>
    </div>
</tb-modal>

<tb-modal *ngIf="activeBoard"
    modal-title="{{ modalProps.id === 0
        ? strings['boards_addTask']
        : strings['boards_editTask'] }}"
    modal-id="{{ MODAL_ID + columnData.id }}">
    <label>
        {{ strings['boards_taskTitle'] }}
        <input #focusMe type="text" name="title"
            [placeholder]="strings['boards_taskTitlePlaceholder']"
            [(ngModel)]="modalProps.title">
    </label>

    <label>
        {{ strings['boards_taskDescription'] }}
        <textarea name="description" rows="5"
            [placeholder]="strings['boards_taskDescriptionPlaceholder']"
            (keyup.enter)="preventEnter($event)"
            [(ngModel)]="modalProps.description"></textarea>
    </label>

    <label>
        {{ strings['boards_taskAssignees'] }}
        <select name="assignees" multiple [(ngModel)]="modalProps.assignees">
            <option *ngFor="let user of activeBoard.users"
                [ngValue]="user">{{ user.username }}</option>
        </select>
    </label>

    <label>
        {{ strings['boards_taskCategories'] }}
        <select name="categories" multiple [ngModel]="modalProps.categories"
            (ngModelChange)="updateTaskColorByCategory($event)">
            <option *ngFor="let category of activeBoard.categories"
                [ngValue]="category">{{ category.name }}</option>
        </select>
    </label>

    <div class="half">
        <label>
            {{ strings['boards_taskColumn'] }}
            <select name="column" [(ngModel)]="modalProps.column_id">
                <option *ngFor="let column of activeBoard.columns"
                    [ngValue]="column.id">{{ column.name }}</option>
            </select>
        </label>

        <label>
            {{ strings['boards_taskColor'] }}
            <input type="color" [(ngModel)]="modalProps.color">
        </label>
    </div>

    <div class="half">
        <label>
            {{ strings['boards_taskDateDue'] }}
            <input type="date" [(ngModel)]="modalProps.due_date">
        </label>

        <label>
            {{ strings['boards_taskPoints'] }}
            <input type="number" [(ngModel)]="modalProps.points">
        </label>
    </div>

    <div class="buttons">
        <button #defaultAction *ngIf="modalProps.id === 0"
            (click)="addTask()" [disabled]="saving">
            <i class="icon icon-plus"></i>
            {{ strings['boards_addTask'] }}
        </button>
        <button #defaultAction *ngIf="modalProps.id !== 0"
            (click)="updateTask()" [disabled]="saving">
            <i class="icon icon-floppy"></i>
            {{ strings['boards_saveTask'] }}
        </button>
        <button class="flat" (click)="modal.close(MODAL_ID + columnData.id)">
            {{ strings['cancel'] }}
        </button>
    </div>
</tb-modal>

